window.addEventListener("load",function(){if(parent.DIPF_PISA_WRAPPER.getCurrentItemNos){const page=parent.DIPF_PISA_WRAPPER.getCurrentItemNos();[["question_number",page[0]],["question_number_total",page[1]]].forEach(dat=>{const el=document.getElementsByClassName(dat[0]);if(el.length>0){for(let h=el.length-1;h>=0;h--){el.item(h).innerText=dat[1].toString()}}})}if(parent.DIPF_PISA_WRAPPER){const allStates=parent.DIPF_PISA_WRAPPER.getAllStates();const thisItem=allStates.item;setState(thisItem,allStates);window.getState=__getState.bind(window,thisItem)}function sendTextEvent(ev){const evData={event:"TXT_"+ev.type.toUpperCase(),name:ev.target.id};if(ev.type=="keydown"){evData.which=ev.which||ev.keyCode;["key","code","shiftKey","altKey","ctrlKey","metaKey","isComposing","repeat"].forEach(k=>{if(ev[k]){evData[k]=ev[k]}});const selSt=ev.target.selectionStart;if(typeof selSt==="number"){evData.selSt=selSt;const selEnd=ev.target.selectionEnd;if(selEnd!=selSt){evData.selEnd=selEnd}}}else if(ev.type=="change"||ev.type=="input"){evData.newText=ev.target.value}if(parent.DIPF_PISA_WRAPPER){parent.DIPF_PISA_WRAPPER.sendEvent(evData)}}list=document.querySelectorAll("textarea");for(let h=0;h<list.length;h++){const field=list.item(h);["click","touchstart","focus","blur","change","keydown"].forEach(e=>field.addEventListener(e,sendTextEvent))}function sendRadioEvent(ev){const click=ev.type=="click"||ev.type=="touchstart";const evData={event:"RAD_"+(click?"CLICKED":"CHANGED"),name:ev.target.name,val:ev.target.id};if(parent.DIPF_PISA_WRAPPER){parent.DIPF_PISA_WRAPPER.sendEvent(evData)}}list=document.querySelectorAll("input[type=radio]");for(let h=0;h<list.length;h++){const field=list.item(h);["click","touchstart"].forEach(e=>field.addEventListener(e,sendRadioEvent))}});function __getState(thisItem){const allStates=parent.DIPF_PISA_WRAPPER.getAllStates();if(allStates.item!==thisItem){return}let state={};let list;list=document.querySelectorAll("textarea");for(let h=0;h<list.length;h++){const field=list.item(h);if(!field.readonly){state[field.id]=field.value}}list=document.querySelectorAll("input[type=radio]");for(let h=0;h<list.length;h++){const field=list.item(h);if(field.checked){state[field.name]=field.id}}if(typeof _drawingTool==="object"){state[allStates.item+"_DT"]=_drawingTool.save()}return state}function setState(itemname,state){let list;list=document.querySelectorAll("textarea");for(let h=0;h<list.length;h++){const field=list.item(h);if(!field.readonly&&field.id in state){field.value=state[field.id]}}list=document.querySelectorAll("input[type=radio]");for(let h=0;h<list.length;h++){const field=list.item(h);if(field.name in state){field.checked=field.id==state[field.name]}}if(typeof _drawingTool==="object"&&itemname+"_DT"in state){_drawingTool.load(state[itemname+"_DT"])}}function setTextFromState(dst,src){const el=document.getElementById(dst);if(el){const m=dst.match(/TXT([0-9]+)$/);if(m){const allStates=parent.DIPF_PISA_WRAPPER.getAllStates();el.innerText=allStates[`${src}TXT${m[1]-1}`]}}}
